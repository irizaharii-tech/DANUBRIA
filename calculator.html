<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freight Rate Calculator | Danubria Logistics</title>
    <meta name="description" content="Instant freight rate calculator for international transport between Spain and Europe">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Navigation -->
    <nav class="glassmorphism fixed w-full z-40 py-4 px-6 shadow-sm">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0yMCA0MEMzMS4wNDU3IDQwIDQwIDMxLjA0NTcgNDAgMjBDNDAgOC45NTQzIDMxLjA0NTcgMCAyMCAwQzguOTU0MyAwIDAgOC45NTQzIDAgMjBDMCAzMS4wNDU3IDguOTU0MyA0MCAyMCA0MFoiIGZpbGw9IiMwRUE1RTkiLz4KICAgIDxwYXRoIGQ9Ik0yMCAxMEMxNC40NzcyIDEwIDEwIDE0LjQ3NzIgMTAgMjBDMTAgMjUuNTIyOCAxNC40NzcyIDMwIDIwIDMwQzI1LjUyMjggMzAgMzAgMjUuNTIyOCAzMCAyMEMzMCAxNC40NzcyIDI1LjUyMjggMTAgMjAgMTBaTTE2IDI0TDEyIDIwTDEzLjQxNDIgMTguNTg1OEwxNiAyMS4xNzE2TDI2LjU4NTggMTAuNTg1OEwyOCAxMkwxNiAyNFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==" alt="Danubria Logo" class="w-10 h-10">
                <span class="text-xl font-semibold">DANUBRIA</span>
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="/index.html" class="text-gray-800 hover:text-blue-600">Home</a>
                <a href="/index.html#network" class="text-gray-800 hover:text-blue-600">Our Network</a>
                <a href="/index.html#services" class="text-gray-800 hover:text-blue-600">Services</a>
                <a href="/calculator.html" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Instant Quote</a>
            </div>
        </div>
    </nav>

    <!-- Calculator Section -->
    <section class="pt-32 pb-20 px-4 max-w-4xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">Instant Freight Calculator</h1>
            <p class="text-lg text-gray-600">Get an instant estimate for your international transport</p>
        </div>
        
        <div class="bg-white rounded-xl shadow-md p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label for="origin" class="block text-sm font-medium mb-1">Origin City</label>
                    <input id="origin" class="w-full px-4 py-2 border rounded-md" placeholder="e.g. Barcelona">
                </div>
                <div>
                    <label for="destination" class="block text-sm font-medium mb-1">Destination City</label>
                    <input id="destination" class="w-full px-4 py-2 border rounded-md" placeholder="e.g. Milan">
                </div>
            </div>
            <button id="calculate-btn" class="w-full bg-blue-600 text-white py-3 px-6 rounded-md hover:bg-blue-700 transition-colors text-lg font-medium">
                Calculate Quote
            </button>

            <div id="quote-result" class="hidden fade-in bg-blue-50 p-6 rounded-lg mt-6">
                <h3 class="text-lg font-semibold text-blue-800">Estimated Price</h3>
                <p class="text-2xl font-bold text-blue-900" id="price-estimate">€0.00</p>
                <p class="text-sm text-blue-700" id="distance-info">Distance: 0 km</p>
                <p class="text-sm text-blue-700" id="rate-info">Rate: €0.00 per km</p>
            </div>
        </div>
    </section>

    <script>
        const ORS_API_KEY = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImQ2Mjg4MTJjNjJhYzRjZTdhNmM5MGFlNTFjYTRkNjk2IiwiaCI6Im11cm11cjY0In0=";

        const rates = {
            'es-it': 1.15,
            'it-es': 1.80,
            'default': 1.50
        };

        document.addEventListener("DOMContentLoaded", () => {
            feather.replace();
            const calculateBtn = document.getElementById("calculate-btn");
            const quoteResult = document.getElementById("quote-result");

            calculateBtn.addEventListener("click", async () => {
                const origin = document.getElementById("origin").value.trim();
                const destination = document.getElementById("destination").value.trim();

                if (!origin || !destination) {
                    alert("Please enter both origin and destination cities.");
                    return;
                }

                // Geocode both locations
                const originCoords = await geocodeCity(origin);
                const destinationCoords = await geocodeCity(destination);

                if (!originCoords || !destinationCoords) {
                    alert("Could not find one of the cities. Check spelling.");
                    return;
                }

                // If route is Spain <-> Italy, force via Nice
                let waypoints = [];
                if (isSpain(origin) && isItaly(destination) || isItaly(origin) && isSpain(destination)) {
                    waypoints = [[7.26, 43.7]]; // Nice
                }

                const distance = await getDrivingDistance(originCoords, destinationCoords, waypoints);

                if (!distance) {
                    alert("Could not calculate route.");
                    return;
                }

                const rate = getRate(origin, destination);
                const price = Math.round(distance * rate * 100) / 100;

                document.getElementById("price-estimate").textContent = `€${price.toLocaleString()}`;
                document.getElementById("distance-info").textContent = `Distance: ${distance} km`;
                document.getElementById("rate-info").textContent = `Rate: €${rate} per km`;

                quoteResult.classList.remove("hidden");
            });
        });

        async function geocodeCity(city) {
            const response = await fetch(`https://api.openrouteservice.org/geocode/search?api_key=${ORS_API_KEY}&text=${encodeURIComponent(city)}`);
            const data = await response.json();
            if (data.features && data.features.length > 0) {
                return data.features[0].geometry.coordinates;
            }
            return null;
        }

        async function getDrivingDistance(start, end, waypoints = []) {
            const coords = [start, ...waypoints, end];
            const response = await fetch("https://api.openrouteservice.org/v2/directions/driving-car", {
                method: "POST",
                headers: {
                    "Authorization": ORS_API_KEY,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ coordinates: coords })
            });

            const data = await response.json();
            if (data.routes && data.routes.length > 0) {
                return Math.round(data.routes[0].summary.distance / 1000); // in km
            }
            return null;
        }

        function getRate(origin, destination) {
            if (isSpain(origin) && isItaly(destination)) return rates["es-it"];
            if (isItaly(origin) && isSpain(destination)) return rates["it-es"];
            return rates["default"];
        }

        function isSpain(city) {
            return ["madrid","barcelona","valencia","irun","zaragoza","bilbao","seville","malaga"].includes(city.toLowerCase());
        }
        function isItaly(city) {
            return ["milan","turin","bologna","venice","verona","florence","rome","naples","bari"].includes(city.toLowerCase());
        }
    </script>
</body>
</html>
